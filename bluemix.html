<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>Advanced: Deploying First Discovery to Bluemix | First Discovery Tool Documentation</title>
        <link rel="icon" type="image/png" href="images/favico.png">

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/foundation.min.css">
        <link rel="stylesheet" href="css/highlightjs-custom.css">
        <link rel="stylesheet" href="lib/infusion/src/lib/jquery/ui/css/default-theme/jquery.ui.theme.css">

        <link rel="stylesheet" type="text/css" href="lib/infusion/src/framework/preferences/css/Enactors.css" />
        <link rel="stylesheet" type="text/css" href="lib/infusion/src/framework/preferences/css/PrefsEditor.css" />
        <link rel="stylesheet" type="text/css" href="lib/infusion/src/framework/preferences/css/SeparatedPanelPrefsEditor.css" />
        <link rel="stylesheet" href="css/docs-first-discovery.css">

        <script type="text/javascript" src="lib/infusion/infusion-uio.js"></script>
        <script type="text/javascript" src="js/DocsCore.js"></script>
        <script type="text/javascript" src="lib/jqueryui/jquery-ui.min.js"></script>
    </head>
    <body class="docs-template docs-core-sidebar-expanded">

        <div class="container docs-template-container">

            <!-- Skip Link -->
            <nav id="skip" class="fl-inverted-color">
                <a href="#topics" class="docs-template-skip-topics">Skip to Topics</a>
                <a href="#content" class="docs-template-skip-content">Skip to Content</a>
            </nav>
            <!-- END skip link -->


            <header class="ignore-for-TOC row fl-inverted-color">
                <!-- BEGIN markup for Preference Editor -->
                <div class="flc-prefsEditor-separatedPanel fl-prefsEditor-separatedPanel">
                    <!-- This is the div that will contain the Preference Editor component -->
                    <div class="flc-slidingPanel-panel flc-prefsEditor-iframe"></div>

                    <!-- This div is for the sliding panel that shows and hides the Preference Editor controls -->
                    <div class="fl-panelBar">
                        <span class="fl-prefsEditor-buttons">
                            <button id="reset" class="flc-prefsEditor-reset fl-prefsEditor-reset"><span class="fl-icon-undo"></span> Reset</button>
                            <button id="show-hide" class="flc-slidingPanel-toggleButton fl-prefsEditor-showHide">+ show display preferences</button>
                        </span>
                    </div>
                </div>
                <!-- END markup for Preference Editor -->

                <div class="small-12 column docs-template-header">
                    <a class="docs-template-logo" href="index.html" title="Home: First Discovery Tool Documentation">
                        <span class="show-for-sr">
                            <h1>Documentation for the First Discovery Tool</h1>
                        </span>
                        <span aria-hidden="true">
                            <h1>First Discovery Tool</h1>
                            <span class="docs-template-tagline">Documentation</span>
                        </span>
                    </a>

                    
                    <nav class="right show-for-small-only docs-template-nav-mobile">
                        <ul id="menu">
                            <li class="docs-template-dropDown-header"><span class="docs-template-nav-mobile-icon"></span>
                                <ul class="docs-template-dropDown">
                                    
                                    
                                        
                                            <li><a href="index.html" title="Overview">Overview</a></li>
                                        
                                    
                                        
                                            <li class="docs-template-category-active"><span aria-label="Currently on Category: Tutorials">Tutorials</span></li>
                                        
                                    
                                        
                                            <li><a href="index-api.html" title="API">API</a></li>
                                        
                                    
                                </ul>
                            </li>
                        </ul>
                    </nav>
                </div>

                <div class="docs-template-header">
                    <nav class="small-12 column show-for-medium-up">
                        <ul class="inline-list right">
                        
                        
                            
                                <li><a href="index.html" title="Overview">Overview</a></li>
                            
                        
                            
                                <li class="docs-template-category-active"><span aria-label="Currently on Category: Tutorials">Tutorials</span></li>
                            
                        
                            
                                <li><a href="index-api.html" title="API">API</a></li>
                            
                        
                        </ul>
                    </nav>
                </div>
            </header>

            <div class="docs-corec-sidebar-bar ignore-for-TOC docs-template-topics-container small-8 medium-3 column">
                <nav id="topics" class="docs-template-topics" tabindex="-1">
                    
                        
                        
                    
                        
                        
                            <h2 class="docs-template-category">Tutorials</h2>
                            
                                <h3 class="docs-template-sectionName">Customizing the First Discovery Tool</h3>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="reordering.html">Simplest: Reordering preferences</a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="removing.html">Less simple: Removing preferences</a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="adding.html">More complicated: Adding a simple preference </a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="enactors.html">Enactors</a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="serverConfig.html">Advanced: Configuring the connection to the Preferences Server</a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <span aria-label="Currently on: Advanced: Deploying First Discovery to Bluemix" class="docs-template-topics-active">Advanced: Deploying First Discovery to Bluemix</span>
                                            
                                        </li>
                                    
                                </ul>
                            
                        
                    
                        
                        
                    
                </nav>
            </div>

            <div class="docs-template-articleBody small-12 medium-8 column">

                <div class="small-4 medium-1 column docs-template-topics-hideShow fl-inverted-color">
                    <a href="#" class="docs-corec-sidebar-toggle">Topics</a>
                </div>

                <article id="content">
                    <h1>Advanced: Deploying First Discovery to Bluemix</h1>

                    <div class="flc-toc-tocContainer docs-template-uio-toc"> </div>


                    <div class="docs-template-articleContent">
                        <h2 id="introduction">Introduction</h2>
<p>You can get an internet accessible website serving the First Discovery Tool up and running with relative
ease using <a href="http://bluemix.net">IBM Bluemix</a> and this tutorial will guide you through doing just that. </p>
<h2 id="requirements">Requirements</h2>
<p>This tutorial assumes you have the following software installed:</p>
<ul>
<li><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">git</a></li>
<li><a href="https://docs.docker.com/engine/installation/">Docker</a></li>
<li><a href="https://docs.cloudfoundry.org/cf-cli/install-go-cli.html">Cloud Foundry command line interface</a></li>
<li><a href="https://console.ng.bluemix.net/docs/containers/container_cli_ov.html">IBM Containers Plugin for Cloud Foundry</a></li>
</ul>
<p>If you need help with any of those try looking <a href="https://developer.ibm.com/answers/questions/201537/how-to-install-the-prereqs-to-run-supported-ibm-co.html">here</a> for more information.
You should also have a <a href="https://console.ng.bluemix.net/registration/">Bluemix account.</a></p>
<h2 id="overview-of-components">Overview of Components</h2>
<p>First, lets go over the components involved. </p>
<ol>
<li><strong>First Discovery Tool</strong> - this is the Infusion based client side app. It runs in your web browser.</li>
<li><strong>First Discovery Server</strong> - this is the server side component that will serve up the First Discovery Tool and proxy requests to the GPII Flow Manager.</li>
</ol>
<h2 id="quick-version">Quick version</h2>
<h3 id="login-">Login:</h3>
<pre class="highlight"><code class="hljs livecodeserver">cf login -<span class="hljs-operator">a</span> <span class="hljs-keyword">https</span>://api.ng.bluemix.net -o &lt;orginization -s &lt;<span class="hljs-constant">space</span>&gt;
</code></pre><h3 id="init-containers-plugin-">Init containers plugin:</h3>
<pre class="highlight"><code class="hljs nginx"><span class="hljs-title">cf</span> ic init
</code></pre><h3 id="set-organization-namespace-">Set organization namespace:</h3>
<pre class="highlight"><code class="hljs cpp">cf ic <span class="hljs-keyword">namespace</span> <span class="hljs-stl_container"><span class="hljs-built_in">set</span> &lt;<span class="hljs-keyword">namespace</span>&gt;</span>
</code></pre><h3 id="create-a-scratch-space-">Create a scratch space:</h3>
<pre class="highlight"><code class="hljs livecodeserver">cf <span class="hljs-built_in">create</span>-<span class="hljs-constant">space</span> tutorial &amp;&amp; cf target -s tutorial
</code></pre><h3 id="build-first-discovery-server-image-">Build first discovery server image:</h3>
<pre class="highlight"><code class="hljs vim">git clone http<span class="hljs-variable">s:</span>//github.<span class="hljs-keyword">com</span>/GPII/<span class="hljs-keyword">first</span>-discovery-server.git 
<span class="hljs-keyword">cf</span> ic build --rm=true --<span class="hljs-keyword">no</span>-cache=true -<span class="hljs-keyword">t</span> first_discovery_server <span class="hljs-keyword">first</span>-discovery-server
</code></pre><h3 id="create-the-container-group-">Create the container group:</h3>
<pre class="highlight"><code class="hljs haml">cf ic group create \
    -<span class="ruby">p <span class="hljs-number">8088</span> \
</span>    -<span class="ruby">-min <span class="hljs-number">1</span> \
</span>    -<span class="ruby">-max <span class="hljs-number">2</span> \
</span>    -<span class="ruby">-desired <span class="hljs-number">1</span> \
</span>    -<span class="ruby">-memory <span class="hljs-number">256</span> \
</span>    -<span class="ruby">-name first-discovery-group \
</span>    -<span class="ruby">e <span class="hljs-constant">NODE_ENV</span>=bluemix \
</span>    -<span class="ruby">e <span class="hljs-constant">GPII_OAUTH2_AUTH_CLIENT_ID</span>=<span class="hljs-string">"net.gpii.prefsEditors.firstDiscovery"</span> \
</span>    -<span class="ruby">e <span class="hljs-constant">GPII_OAUTH2_AUTH_CLIENT_SECRET</span>=<span class="hljs-string">"client_secret_firstDiscovery"</span> \
</span>    -<span class="ruby">e <span class="hljs-constant">GPII_OAUTH2_HOST_NAME</span>=<span class="hljs-string">"http://flowmanager-&lt;your initials&gt;.mybluemix.net"</span> \       <span class="hljs-comment"># use your initials to make the URL unique</span>
</span>    -<span class="ruby">e <span class="hljs-constant">GPII_OAUTH2_TCP_PORT</span>=<span class="hljs-string">"80"</span> \
</span>    registry.ng.bluemix.net/&lt;namespace&gt;/first_discovery_server:latest                   # use your own namespace here
</code></pre><h3 id="map-the-route">Map the route</h3>
<pre class="highlight"><code class="hljs vim"><span class="hljs-keyword">cf</span> ic route <span class="hljs-built_in">map</span> --<span class="hljs-built_in">hostname</span> firstdiscovery-&lt;your initials&gt; --domain mybluemix.net <span class="hljs-keyword">first</span>-discovery-group
</code></pre><h3 id="test">Test</h3>
<p>Open the route <code>http://firstdiscovery-&lt;your initials&gt;.mybluemix.net/demos/prefsServerIntegration</code> in your browser. </p>
<h2 id="setup-bluemix-cloud-foundry-cli-and-ibm-containers">Setup Bluemix, Cloud Foundry CLI, and IBM Containers</h2>
<h3 id="login">Login</h3>
<p>Run the following commands to initialize your tools.</p>
<pre class="highlight"><code class="hljs livecodeserver">cf login -<span class="hljs-operator">a</span> <span class="hljs-keyword">https</span>://api.ng.bluemix.net -o &lt;orginization -s &lt;<span class="hljs-constant">space</span>&gt;
</code></pre><p>Note: some examples in this tutorial require you to use values that are specific to you. These are noted in commands with the use of angle brackets such as <code>&lt;organization&gt;</code> and <code>&lt;space&gt;</code> in the previous command. </p>
<p>If you don&#39;t know what your orginization and space are you can ommit them to login interactively:</p>
<pre class="highlight"><code class="hljs stylus">cf login -<span class="hljs-tag">a</span> https:<span class="hljs-comment">//api.ng.bluemix.net</span>
</code></pre><p>Note: If you&#39;ve just signed up your orginization is <em>probably</em> your e-mail address and your space is <em>probably</em> &quot;dev&quot;</p>
<h3 id="initialize-the-containers-plugin">Initialize the containers plugin</h3>
<p>Run the follow command to initialize your IBM containers plugin:</p>
<pre class="highlight"><code class="hljs nginx"><span class="hljs-title">cf</span> ic init
</code></pre><h3 id="set-organization-container-namespace">Set organization container namespace</h3>
<p>Set your organization&#39;s namespace with the following commands. You may have set this already and if so this command will fail.</p>
<pre class="highlight"><code class="hljs cpp">cf ic <span class="hljs-keyword">namespace</span> <span class="hljs-stl_container"><span class="hljs-built_in">set</span> &lt;<span class="hljs-keyword">namespace</span>&gt;</span>
</code></pre><h3 id="create-a-new-space">Create a new space</h3>
<p>Bluemix uses the concept of spaces to organize applications. Create and switch to a new space to hold the items created in this tutorial with the following commands.</p>
<pre class="highlight"><code class="hljs livecodeserver">cf <span class="hljs-built_in">create</span>-<span class="hljs-constant">space</span> tutorial
cf target -s tutorial
</code></pre><h2 id="deploy-the-first-discovery-server">Deploy the First Discovery Server</h2>
<p>The First Discovery Server includes the First Discovery Tool as a dependency so this step will take care of deploying both the First Discovery Tool <em>and</em> the First Discovery Server. These are referred to in the Overview of Components section as items 1 and 2.</p>
<h3 id="obtain-the-source">Obtain the source</h3>
<p>Obtain the source for the First Discovery Server:</p>
<pre class="highlight"><code class="hljs vim">git clone http<span class="hljs-variable">s:</span>//github.<span class="hljs-keyword">com</span>/GPII/<span class="hljs-keyword">first</span>-discovery-server.git
</code></pre><h3 id="update-the-first-discovery-tool-version">Update the First Discovery Tool Version</h3>
<p>Optionally, edit <code>package.json</code> from the <code>first-discovery-server</code> repository and edit the <code>&quot;first-discovery&quot;</code> dependency to a version of your choosing. </p>
<p>In this tutorial we will be using this version:</p>
<pre class="highlight"><code class="hljs 1c"> <span class="hljs-string">"first-discovery"</span>: <span class="hljs-string">"git+https://github.com/pga03/first-discovery.git#344530e2bed3653126d29e1e1763d089f2451f5b"</span>,
</code></pre><h3 id="build-the-image-and-push-to-bluemix">Build the image and push to Bluemix</h3>
<p>Build the image and push it to Bluemix by running this command from the <code>first-discovery-server</code> folder: </p>
<pre class="highlight"><code class="hljs nginx"> <span class="hljs-title">cf</span> ic build --rm=<span class="hljs-built_in">true</span> --<span class="hljs-built_in">no</span>-cache=<span class="hljs-built_in">true</span> -t first_discovery_server .
</code></pre><p>Verify the image is listed in your registry:</p>
<pre class="highlight"><code class="hljs nginx"><span class="hljs-title">cf</span> ic images
</code></pre><h3 id="create-a-container-group">Create a container group</h3>
<p>A container group in Bluemix is a cluster of containers, but in this tutorial we only create a single container
in the group. </p>
<pre class="highlight"><code class="hljs haml">cf ic group create \
-<span class="ruby">p <span class="hljs-number">8088</span> \
</span>-<span class="ruby">-min <span class="hljs-number">1</span> \
</span>-<span class="ruby">-max <span class="hljs-number">2</span> \
</span>-<span class="ruby">-desired <span class="hljs-number">1</span> \
</span>-<span class="ruby">-memory <span class="hljs-number">256</span> \
</span>-<span class="ruby">-name first-discovery-group \
</span>-<span class="ruby">e <span class="hljs-constant">NODE_ENV</span>=bluemix \
</span>-<span class="ruby">e <span class="hljs-constant">GPII_OAUTH2_AUTH_CLIENT_ID</span>=<span class="hljs-string">"net.gpii.prefsEditors.firstDiscovery"</span> \
</span>-<span class="ruby">e <span class="hljs-constant">GPII_OAUTH2_AUTH_CLIENT_SECRET</span>=<span class="hljs-string">"client_secret_firstDiscovery"</span> \
</span>-<span class="ruby">e <span class="hljs-constant">GPII_OAUTH2_HOST_NAME</span>=<span class="hljs-string">"http://flowmanager-&lt;your initials&gt;.mybluemix.net"</span> \       <span class="hljs-comment"># use your initials to make the URL unique</span>
</span>-<span class="ruby">e <span class="hljs-constant">GPII_OAUTH2_TCP_PORT</span>=<span class="hljs-string">"80"</span> \
</span>registry.ng.bluemix.net/&lt;namespace&gt;/first_discovery_server:latest                   # use your own namespace here
</code></pre><p>Note: These OAUTH2 secrets are taken from <a href="https://github.com/GPII/universal/blob/master/testData/security/TestOAuth2DataStore.js">test data</a></p>
<h3 id="monitor-container-group-creation">Monitor container group creation</h3>
<pre class="highlight"><code class="hljs lasso">cf ic <span class="hljs-keyword">group</span> <span class="hljs-built_in">list</span>
</code></pre><p>Continue to the next step when the Status is <code>CREATE_COMPLETE</code></p>
<h3 id="map-a-route-to-the-container-group">Map a route to the container group</h3>
<pre class="highlight"><code class="hljs vim"><span class="hljs-keyword">cf</span> ic route <span class="hljs-built_in">map</span> --<span class="hljs-built_in">hostname</span> firstdiscovery-&lt;your initials&gt; --domain mybluemix.net <span class="hljs-keyword">first</span>-discovery-group
</code></pre><p>Note: If you recieve an error message of <code>{&quot;message&quot;: &quot;check domain error - failed to create domain, details: Invalid Auth Token&quot;}</code> then run the command below and try to map the route again.</p>
<pre class="highlight"><code class="hljs nginx"><span class="hljs-title">cf</span> ic init
</code></pre><h3 id="test-the-route">Test the route</h3>
<p>Open the route <code>http://firstdiscovery-&lt;your initials&gt;.mybluemix.net/demos/prefsServerIntegration</code> in your browser. </p>
<p>Congratulations your site is now live!</p>

                    </div>

                    <p class="docs-template-githubLink"><a href="https://github.com/GPII/docs-first-discovery/blob/master/src/documents/bluemix.md" rel="nofollow" target="_blank" class="link-external">Edit this Page on GitHub</a></p>
                </article>

            </div>

            <footer class="row docs-template-footer fl-inverted-color">
                <p>The First Discovery Tool was developed by the <a href="http://idrc.ocad.ca/" rel="nofollow" target="_blank">Inclusive Design Research Centre</a>,<br/>
                through the <a href="https://wiki.fluidproject.org/display/fluid/Preferences+for+Global+Access">Preferences for Global Access</a> project,
                funded by the US Dept. of Educations's <a href="http://www.ed.gov/category/program/national-institute-disability-and-rehabilitation-research">National Institute on Disability and Rehabilitation Research</a>.</p>
            </footer>

            <script type="text/javascript">
                docsCore.init("./");
                jQuery( "#menu" ).menu({
                    position: {my: "right top", at: "right bottom"},
                    icons: {submenu:"ui-icon-blank"},
                    // Remove the anchors from the tabindex as they are triggered
                    // via the select event. (see below)
                    create: function (event, ui) {
                        jQuery("#menu .ui-menu-item a").attr("tabindex", -1);
                    },
                    // The jQuery menu doesn't seem to like it when the <a> are
                    // specified as the "item" and are nested under an <li>. There
                    // seems to be styling issues and occassionally an error thrown.
                    // The page transition work around below is used to maintian the semantic structure,
                    // while allowing the menu to behave as normal.
                    select: function( event, ui ) {
                        var location = ui.item.children("a").attr("href");
                        if (location) {
                            window.location.href = location;
                        }
                    }
                });
            </script>
        </div> <!-- end container -->

    </body>
</html>
